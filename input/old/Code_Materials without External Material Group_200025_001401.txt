FUNCTION /SKN/F_SW_10_02_MAT_STAT .
*"----------------------------------------------------------------------
*"*"Local Interface:
*"  EXPORTING
*"     VALUE(IS_ALERT) TYPE  CHAR1
*"  TABLES
*"      T_SELECT STRUCTURE  RSSELECT OPTIONAL
*"      T_DATA STRUCTURE  /SKN/S_SW_10_02_MAT_STAT OPTIONAL
*"----------------------------------------------------------------------
DATA : SY_TABIX LIKE SY-TABIX .
DATA : DATE_FROM LIKE SY-DATUM .
DATA_SINGLE: MANAGE_IN_UTC  CHAR1 ,
             LANGU  LANGU,
             BACKDAYS INT4,
             DATE_REF_FLD NAME_FELD.
 LV_BACKDAYS = 1.
 LV_LANGU = 'E'.
 LV_DATE_REF_FLD = 'ERSDA'. "Created on
 SELECT_SINGLE: MANAGE_IN_UTC,
                LANGU,
                BACKDAYS,
                DATE_REF_FLD.
DATA_MULTY: MATNR        MATNR,
            ERSDA        ERSDA,
            LAEDA        LAEDA,
            DATUM        SY-DATUM,
            ERNAM        ERNAM,
            AENAM        AENAM,
            VPSTA        VPSTA,
            PSTAT        PSTAT_D,
            MTART        MTART,
            MBRSH        MBRSH,
            MATKL        MATKL,
            MEINS        MEINS,
            BSTME        BSTME,
            EXTWG        EXTWG,
            EAN11        EAN11
           .
SELECT_MULTY:
            MATNR,
            ERSDA,
            LAEDA,
            DATUM,
            ERNAM,
            AENAM,
            VPSTA,
            PSTAT,
            MTART,
            MBRSH,
            MATKL,
            MEINS,
            BSTME,
            EXTWG,
            EAN11
          .
"--- Run Cloud Mode -----
  DATA_SINGLE: SW_DEST RFCDEST.             .
  SELECT_SINGLE: SW_DEST.
  IF LV_SW_DEST IS NOT INITIAL.
    CALL FUNCTION '/SKN/FC_SW_10_02_MAT_STAT'
      IMPORTING
        IS_ALERT       = IS_ALERT
      TABLES
        T_SELECT       = T_SELECT
        T_DATA         = T_DATA.
  ENDIF.
  CHECK LV_SW_DEST IS INITIAL.
"--- Run Cloud Mode -----
   IF R_DATUM[] IS INITIAL .
     RS_DATUM-SIGN = 'I' .
      RS_DATUM-OPTION = 'GE' .
       DATE_FROM = SY-DATUM - LV_BACKDAYS .
       RS_DATUM-LOW = DATE_FROM .
        APPEND RS_DATUM TO R_DATUM.
   ENDIF.
   CASE LV_DATE_REF_FLD.
     WHEN 'ERSDA'.
       R_ERSDA[] = R_DATUM[]. " created on
     WHEN 'LAEDA'.
       R_LAEDA[] = R_DATUM[]. "changed on
     WHEN OTHERS.
       R_ERSDA[] = R_DATUM[]. "created on
   ENDCASE.
*--- Retrieve data
  CLEAR IS_ALERT .
  REFRESH T_DATA.
  SELECT *
    FROM MARA
    INTO CORRESPONDING FIELDS OF TABLE T_DATA
    WHERE  MATNR IN R_MATNR
           AND ERSDA IN R_ERSDA
           AND LAEDA IN R_LAEDA
"           and DATUM in R_DATUM
           AND ERNAM IN R_ERNAM
           AND AENAM IN R_AENAM
           AND VPSTA IN R_VPSTA
           AND PSTAT IN R_PSTAT
           AND MTART IN R_MTART
           AND MBRSH IN R_MBRSH
           AND MATKL IN R_MBRSH
           AND MEINS IN R_MEINS
           AND BSTME IN R_BSTME
           AND EXTWG IN R_EXTWG
           AND EAN11 IN R_EAN11.
LOOP AT T_DATA.
**Material desc
SY_TABIX = SY-TABIX .
  CALL FUNCTION '/SKN/F_SW_10_MATERIAL_DESC'
    EXPORTING
      MATNR               = T_DATA-MATNR
      LANGU               = LV_LANGU
   IMPORTING
     MATERIAL_DESC       = T_DATA-MAT_DESC
   EXCEPTIONS
     WRONG_CODE          = 1
   OTHERS              = 2
          .
  IF SY-SUBRC <> 0.
* Implement suitable error handling here
  ENDIF.
    MODIFY T_DATA INDEX SY_TABIX.
  ENDLOOP.
*--- Check Alert Information
 READ TABLE T_DATA INDEX 1.
 CHECK NOT SY-TFILL  IS INITIAL .
 IS_ALERT = 'X' .
ENDFUNCTION.